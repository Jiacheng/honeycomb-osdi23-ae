#!/bin/bash

ROOT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )"/../.. && pwd )"
VALIDATOR_REL_DIR="hypervisor/validator"
VALIDATOR_DIR="${ROOT_DIR}/${VALIDATOR_REL_DIR}"
RUN_TOOL="${ROOT_DIR}/hypervisor/target/release/figure9"

ACCEL_DIR="/home/ae2023/validator/accel_bins"
RESNET_DIR="/home/ae2023/validator/resnet18_bins"
ACCEL_PRECONDITION_DIR="${ROOT_DIR}/experiments/accel_preconditions"
RESNET_PRECONDITION_DIR="${ROOT_DIR}/experiments/resnet18_preconditions"
RESULT_DIR="${ROOT_DIR}/scripts/figure9"
STATS_FILE="${RESULT_DIR}/validation-time.csv"


function build_validator {
    pushd ${VALIDATOR_DIR} > /dev/null
    result=`RUSTFLAGS="--deny warnings" cargo build --release -p validator 2>&1`
    if [ $? -ne 0 ]; then
        echo "Build validator failed"
        printf "%s\n" "${result}"
        exit 1
    fi
    popd > /dev/null
}

function run_accel {
    pushd ${VALIDATOR_DIR} > /dev/null
    ${RUN_TOOL} ${ACCEL_DIR}/cl-76d661dede42cdf0d4d7b1e5e6a68975d9867778bbcd06054eabccef2f8e268b.bin ${ACCEL_PRECONDITION_DIR}/101.tpacf.json gen_hists >> ${STATS_FILE}
    ${RUN_TOOL} ${ACCEL_DIR}/cl-bf84774accf12534106baebeada656d6e325e54b592acad9dba06db399cc6cee.bin ${ACCEL_PRECONDITION_DIR}/103.stencil.json naive_kernel >> ${STATS_FILE}
    ${RUN_TOOL} ${ACCEL_DIR}/cl-680fe254b49dec205f84647da576d940cdea0464da91e6e5c27392d69d0291bd.bin ${ACCEL_PRECONDITION_DIR}/104.lbm.json performStreamCollide_kernel >> ${STATS_FILE}
    ${RUN_TOOL} ${ACCEL_DIR}/cl-0f961d7f0d40722b7c4735d09179ab122a6594b887a0c8b9a3660a68e4f963c4.bin ${ACCEL_PRECONDITION_DIR}/110.fft.json GPU_FFT_Global >> ${STATS_FILE}
    ${RUN_TOOL} ${ACCEL_DIR}/cl-9e5930954b4b01c01a40061c990a9c2706ea6aa837aa87d6dce8d4fbe79587dc.bin ${ACCEL_PRECONDITION_DIR}/112.spmv.json spmv_jds_naive >> ${STATS_FILE}
    ${RUN_TOOL} ${ACCEL_DIR}/cl-a82ab682028b0774ac87ec231a33a85df6973a727a5bff87073672b89dc94431.bin ${ACCEL_PRECONDITION_DIR}/114.mriq.json ComputePhiMag_GPU >> ${STATS_FILE}
    ${RUN_TOOL} ${ACCEL_DIR}/cl-a82ab682028b0774ac87ec231a33a85df6973a727a5bff87073672b89dc94431.bin ${ACCEL_PRECONDITION_DIR}/114.mriq.json ComputeQ_GPU >> ${STATS_FILE}
    ${RUN_TOOL} ${ACCEL_DIR}/cl-2e264856ee6ee860d2afb5871ea060a73ce9c0d4225a95b255a6ed14b908fc2a.bin ${ACCEL_PRECONDITION_DIR}/116.histo.json histo_prescan_kernel >> ${STATS_FILE}
    ${RUN_TOOL} ${ACCEL_DIR}/cl-dd638f0ed1231229ec490afb6ef6cc76beb89a54d6424856b0bc190f470e6c27.bin ${ACCEL_PRECONDITION_DIR}/116.histo.json histo_intermediates_kernel >> ${STATS_FILE}
    ${RUN_TOOL} ${ACCEL_DIR}/cl-dd638f0ed1231229ec490afb6ef6cc76beb89a54d6424856b0bc190f470e6c27.bin ${ACCEL_PRECONDITION_DIR}/116.histo.json calculateBin >> ${STATS_FILE}
    ${RUN_TOOL} ${ACCEL_DIR}/cl-3cb8a90eda993f1dadb39bd902e436f5c3b5659759da869ff98159dc2e74a6e2.bin ${ACCEL_PRECONDITION_DIR}/116.histo.json histo_main_kernel >> ${STATS_FILE}
    ${RUN_TOOL} ${ACCEL_DIR}/cl-98298704ebb52d7949f7edf9b21bb4a3397119281f688fd912a56aabfffba961.bin ${ACCEL_PRECONDITION_DIR}/116.histo.json histo_final_kernel >> ${STATS_FILE}
    ${RUN_TOOL} ${ACCEL_DIR}/cl-de3b33dfbcc30d23d52d49bef7508f515634c58e592c456a4baaddfdb397e437.bin ${ACCEL_PRECONDITION_DIR}/117.bfs.json BFS_kernel >> ${STATS_FILE}
    ${RUN_TOOL} ${ACCEL_DIR}/cl-de3b33dfbcc30d23d52d49bef7508f515634c58e592c456a4baaddfdb397e437.bin ${ACCEL_PRECONDITION_DIR}/117.bfs.json reduce_costs >> ${STATS_FILE}
    ${RUN_TOOL} ${ACCEL_DIR}/cl-7b88f1f0ceca3938bad89591bc16d814370b5580bcc411d338507952ef50e30e.bin ${ACCEL_PRECONDITION_DIR}/118.cutcp.json opencl_cutoff_potential_lattice >> ${STATS_FILE}
    ${RUN_TOOL} ${ACCEL_DIR}/cl-c0a0b6d9ee74a270623b8450036b38c724e0c63deb44e2a0f1fd9c29ce5328f3.bin ${ACCEL_PRECONDITION_DIR}/120.kmeans.json kmeans_kernel_c >> ${STATS_FILE}
    ${RUN_TOOL} ${ACCEL_DIR}/cl-c0a0b6d9ee74a270623b8450036b38c724e0c63deb44e2a0f1fd9c29ce5328f3.bin ${ACCEL_PRECONDITION_DIR}/120.kmeans.json kmeans_swap >> ${STATS_FILE}
    ${RUN_TOOL} ${ACCEL_DIR}/cl-cd5d5e28e39ffe2b1c1f6167389241b23e910c92c79f80fed5ac2b80c92a3bae.bin ${ACCEL_PRECONDITION_DIR}/121.lavamd.json kernel_gpu_opencl >> ${STATS_FILE}
    ${RUN_TOOL} ${ACCEL_DIR}/cl-7d833dfcbb8cfd591693c7716833afadffd50cd68a7c000fc07528a94c73c728.bin ${ACCEL_PRECONDITION_DIR}/122.cfd.json memset_kernel >> ${STATS_FILE}
    ${RUN_TOOL} ${ACCEL_DIR}/cl-7d833dfcbb8cfd591693c7716833afadffd50cd68a7c000fc07528a94c73c728.bin ${ACCEL_PRECONDITION_DIR}/122.cfd.json initialize_variables >> ${STATS_FILE}
    ${RUN_TOOL} ${ACCEL_DIR}/cl-7d833dfcbb8cfd591693c7716833afadffd50cd68a7c000fc07528a94c73c728.bin ${ACCEL_PRECONDITION_DIR}/122.cfd.json compute_step_factor >> ${STATS_FILE}
    ${RUN_TOOL} ${ACCEL_DIR}/cl-7d833dfcbb8cfd591693c7716833afadffd50cd68a7c000fc07528a94c73c728.bin ${ACCEL_PRECONDITION_DIR}/122.cfd.json compute_flux >> ${STATS_FILE}
    ${RUN_TOOL} ${ACCEL_DIR}/cl-7d833dfcbb8cfd591693c7716833afadffd50cd68a7c000fc07528a94c73c728.bin ${ACCEL_PRECONDITION_DIR}/122.cfd.json time_step >> ${STATS_FILE}
    ${RUN_TOOL} ${ACCEL_DIR}/cl-33e2f629cd04e5056814bce53740285641ebe2b969c963c19b5c4538d08ffe1b.bin ${ACCEL_PRECONDITION_DIR}/123.nw.json nw_kernel1 >> ${STATS_FILE}
    ${RUN_TOOL} ${ACCEL_DIR}/cl-33e2f629cd04e5056814bce53740285641ebe2b969c963c19b5c4538d08ffe1b.bin ${ACCEL_PRECONDITION_DIR}/123.nw.json nw_kernel2 >> ${STATS_FILE}
    ${RUN_TOOL} ${ACCEL_DIR}/cl-a9c49d528ab1107195893b103034263542706d6e8467e9f55850351a1ddfe9d7.bin ${ACCEL_PRECONDITION_DIR}/124.hotspot.json hotspot >> ${STATS_FILE}
    ${RUN_TOOL} ${ACCEL_DIR}/cl-f7a37934bb8f9b567e8aaec8c433eee053d8e7361dbb8db7bf38b1f164904a67.bin ${ACCEL_PRECONDITION_DIR}/125.lud.json lud_diagonal >> ${STATS_FILE}
    ${RUN_TOOL} ${ACCEL_DIR}/cl-f7a37934bb8f9b567e8aaec8c433eee053d8e7361dbb8db7bf38b1f164904a67.bin ${ACCEL_PRECONDITION_DIR}/125.lud.json lud_perimeter >> ${STATS_FILE}
    ${RUN_TOOL} ${ACCEL_DIR}/cl-f7a37934bb8f9b567e8aaec8c433eee053d8e7361dbb8db7bf38b1f164904a67.bin ${ACCEL_PRECONDITION_DIR}/125.lud.json lud_internal >> ${STATS_FILE}
    ${RUN_TOOL} ${ACCEL_DIR}/cl-ecd2c2e831d4df8f618d5a60bba95b4b74fc5251d01c61f2ffff849bd59f118e.bin ${ACCEL_PRECONDITION_DIR}/126.ge.json Fan1 >> ${STATS_FILE}
    ${RUN_TOOL} ${ACCEL_DIR}/cl-ecd2c2e831d4df8f618d5a60bba95b4b74fc5251d01c61f2ffff849bd59f118e.bin ${ACCEL_PRECONDITION_DIR}/126.ge.json Fan2 >> ${STATS_FILE}
    ${RUN_TOOL} ${ACCEL_DIR}/cl-4a7e6b3e2f3aae6b9b5311e9c773f97a139de2ecacd69ec3028969cafca2785d.bin ${ACCEL_PRECONDITION_DIR}/127.srad.json extract_kernel >> ${STATS_FILE}
    ${RUN_TOOL} ${ACCEL_DIR}/cl-4a7e6b3e2f3aae6b9b5311e9c773f97a139de2ecacd69ec3028969cafca2785d.bin ${ACCEL_PRECONDITION_DIR}/127.srad.json prepare_kernel >> ${STATS_FILE}
    ${RUN_TOOL} ${ACCEL_DIR}/cl-4a7e6b3e2f3aae6b9b5311e9c773f97a139de2ecacd69ec3028969cafca2785d.bin ${ACCEL_PRECONDITION_DIR}/127.srad.json reduce_kernel >> ${STATS_FILE}
    ${RUN_TOOL} ${ACCEL_DIR}/cl-4a7e6b3e2f3aae6b9b5311e9c773f97a139de2ecacd69ec3028969cafca2785d.bin ${ACCEL_PRECONDITION_DIR}/127.srad.json srad_kernel >> ${STATS_FILE}
    ${RUN_TOOL} ${ACCEL_DIR}/cl-4a7e6b3e2f3aae6b9b5311e9c773f97a139de2ecacd69ec3028969cafca2785d.bin ${ACCEL_PRECONDITION_DIR}/127.srad.json srad2_kernel >> ${STATS_FILE}
    ${RUN_TOOL} ${ACCEL_DIR}/cl-4a7e6b3e2f3aae6b9b5311e9c773f97a139de2ecacd69ec3028969cafca2785d.bin ${ACCEL_PRECONDITION_DIR}/127.srad.json compress_kernel >> ${STATS_FILE}
    popd > /dev/null
}

function run_resnet {
    pushd ${VALIDATOR_DIR} > /dev/null
    ${RUN_TOOL} ${RESNET_DIR}/Cijk_Ailk_Bljk.prep.bin ${RESNET_PRECONDITION_DIR}/Cijk_Ailk_Bljk.json Cijk_Ailk_Bljk_SB_MT128x64x8_SN_1LDSB0_APM1_ABV0_ACED0_AF0EM1_AF1EM1_AMAS3_ASAE01_ASCE01_ASEM1_AAC0_BL1_DTL0_DVO0_EPS1_FL0_GRVW4_GSU1_GSUAMB_GLS0_ISA1030_IU1_K1_KLA_LBSPP0_LPA0_LPB0_LDL1_LRVW4_FMA_MIAV0_MDA2_NTC0_NTD0_NEPBS0_NLCA1_NLCB1_ONLL1_OPLV0_PK0_PAP0_PGR1_PLR1_RK0_SIA1_SS0_SU0_SUM0_SUS0_SCIUI1_SPO0_SRVW0_SSO0_SVW4_SNLL0_TT8_8_TLDS0_USFGROn1_VAW1_VSn1_VW4_WSGRA0_WSGRB0_WS32_WG16_8_1_WGM8 >> ${STATS_FILE}
    ${RUN_TOOL} ${RESNET_DIR}/Cijk_Ailk_Bljk.prep.bin ${RESNET_PRECONDITION_DIR}/Cijk_Ailk_Bljk.json Cijk_Ailk_Bljk_SB_MT128x128x16_SN_1LDSB0_APM1_ABV0_ACED0_AF0EM1_AF1EM1_AMAS3_ASAE01_ASCE01_ASEM1_AAC0_BL1_DTL0_DVO0_EPS0_FL0_GRVW4_GSU1_GSUAMB_GLS0_ISA1030_IU1_K1_KLA_LBSPP0_LPA0_LPB0_LDL1_LRVW4_FMA_MIAV0_MDA2_NTC0_NTD0_NEPBS0_NLCA1_NLCB1_ONLL1_OPLV0_PK0_PAP0_PGR1_PLR1_RK0_SIA1_SS0_SU32_SUM3_SUS128_SCIUI1_SPO0_SRVW0_SSO0_SVW4_SNLL0_TT8_16_TLDS0_USFGROn1_VAW1_VSn1_VW4_WSGRA0_WSGRB0_WS32_WG16_8_1_WGM8 >> ${STATS_FILE}
    ${RUN_TOOL} ${RESNET_DIR}/Cijk_Ailk_Bljk.prep.bin ${RESNET_PRECONDITION_DIR}/Cijk_Ailk_Bljk.json Cijk_Ailk_Bljk_SB_MT32x16x8_SN_1LDSB0_APM1_ABV0_ACED0_AF0EM1_AF1EM1_AMAS0_ASAE01_ASCE01_ASEM1_AAC0_BL1_DTL0_DVO0_EPS1_FL0_GRVW1_GSU1_GSUAMB_GLS0_ISA1030_IU1_K1_KLA_LBSPP0_LPA0_LPB0_LDL1_LRVW1_FMA_MIAV0_MDA2_NTC0_NTD0_NEPBS0_NLCA1_NLCB1_ONLL1_OPLV0_PK0_PAP0_PGR1_PLR1_RK0_SIA1_SS0_SU0_SUM0_SUS0_SCIUI1_SPO0_SRVW0_SSO0_SVW4_SNLL0_TT2_2_TLDS0_USFGROn1_VAW1_VSn1_VW1_WSGRA0_WSGRB0_WS32_WG16_8_1_WGM8 >> ${STATS_FILE}
    ${RUN_TOOL} ${RESNET_DIR}/Cijk_Ailk_Bljk.prep.bin ${RESNET_PRECONDITION_DIR}/Cijk_Ailk_Bljk.json Cijk_Ailk_Bljk_SB_MT32x32x8_SN_1LDSB0_APM1_ABV0_ACED0_AF0EM1_AF1EM1_AMAS0_ASAE01_ASCE01_ASEM1_AAC0_BL1_DTL0_DVO0_EPS1_FL0_GRVW1_GSU1_GSUAMB_GLS0_ISA1030_IU1_K1_KLA_LBSPP0_LPA0_LPB0_LDL1_LRVW1_FMA_MIAV0_MDA2_NTC0_NTD0_NEPBS0_NLCA1_NLCB1_ONLL1_OPLV0_PK0_PAP0_PGR1_PLR1_RK0_SIA1_SS0_SU0_SUM0_SUS0_SCIUI1_SPO0_SRVW0_SSO0_SVW4_SNLL0_TT2_2_TLDS0_USFGROn1_VAW1_VSn1_VW1_WSGRA0_WSGRB0_WS32_WG16_16_1_WGM1 >> ${STATS_FILE}
    ${RUN_TOOL} ${RESNET_DIR}/Cijk_Ailk_Bljk.prep.bin ${RESNET_PRECONDITION_DIR}/Cijk_Ailk_Bljk.json Cijk_Ailk_Bljk_SB_MT32x16x8_SN_1LDSB0_APM1_ABV0_ACED0_AF0EM1_AF1EM1_AMAS0_ASAE01_ASCE01_ASEM1_AAC0_BL1_DTL0_DVO0_EPS1_FL0_GRVW1_GSU1_GSUAMB_GLS0_ISA1030_IU1_K1_KLA_LBSPP0_LPA0_LPB0_LDL1_LRVW1_FMA_MIAV0_MDA2_NTC0_NTD0_NEPBS0_NLCA1_NLCB1_ONLL1_OPLV0_PK0_PAP0_PGR1_PLR1_RK0_SIA1_SS0_SU32_SUM3_SUS128_SCIUI1_SPO0_SRVW0_SSO0_SVW4_SNLL0_TT2_2_TLDS0_USFGROn1_VAW1_VSn1_VW1_WSGRA0_WSGRB0_WS32_WG16_8_1_WGM1 >> ${STATS_FILE}
    ${RUN_TOOL} ${RESNET_DIR}/Cijk_Ailk_Bljk.prep.bin ${RESNET_PRECONDITION_DIR}/Cijk_Ailk_Bljk.json Cijk_Ailk_Bljk_SB_MT64x32x8_SN_1LDSB0_APM1_ABV0_ACED0_AF0EM1_AF1EM1_AMAS0_ASAE01_ASCE01_ASEM1_AAC0_BL1_DTL0_DVO0_EPS1_FL0_GRVW1_GSU4_GSUAMB_GLS0_ISA1030_IU1_K1_KLA_LBSPP0_LPA0_LPB0_LDL1_LRVW1_FMA_MIAV0_MDA2_NTC0_NTD0_NEPBS0_NLCA1_NLCB1_ONLL1_OPLV0_PK0_PAP0_PGR1_PLR1_RK0_SIA1_SS0_SU0_SUM0_SUS0_SCIUI1_SPO0_SRVW0_SSO0_SVW4_SNLL0_TT4_4_TLDS0_USFGROn1_VAW1_VSn1_VW1_WSGRA0_WSGRB0_WS32_WG16_8_1_WGM1 >> ${STATS_FILE}
    ${RUN_TOOL} ${RESNET_DIR}/Cijk_Ailk_Bljk.prep.bin ${RESNET_PRECONDITION_DIR}/Cijk_Ailk_Bljk.json Cijk_Ailk_Bljk_SB_MT32x16x16_SN_1LDSB0_APM1_ABV0_ACED0_AF0EM1_AF1EM1_AMAS0_ASAE01_ASCE01_ASEM1_AAC0_BL1_DTL0_DVO0_EPS1_FL0_GRVW1_GSU1_GSUAMB_GLS0_ISA1030_IU1_K1_KLA_LBSPP0_LPA0_LPB0_LDL1_LRVW1_FMA_MIAV0_MDA2_NTC0_NTD0_NEPBS0_NLCA1_NLCB1_ONLL1_OPLV0_PK0_PAP0_PGR1_PLR1_RK0_SIA1_SS0_SU0_SUM0_SUS0_SCIUI1_SPO0_SRVW0_SSO0_SVW4_SNLL0_TT2_2_TLDS0_USFGROn1_VAW1_VSn1_VW1_WSGRA0_WSGRB0_WS32_WG16_8_1_WGM4 >> ${STATS_FILE}
    ${RUN_TOOL} ${RESNET_DIR}/Cijk_Ailk_Bljk.prep.bin ${RESNET_PRECONDITION_DIR}/Cijk_Ailk_Bljk.json Cijk_Alik_Bljk_SB_MT64x64x8_SN_1LDSB0_APM1_ABV0_ACED0_AF0EM1_AF1EM1_AMAS0_ASAE01_ASCE01_ASEM1_AAC0_BL1_DTL0_DVO0_EPS1_FL0_GRVW1_GSU1_GSUAMB_GLS0_ISA1030_IU1_K1_KLA_LBSPP0_LPA0_LPB0_LDL1_LRVW1_FMA_MIAV0_MDA2_NTC0_NTD0_NEPBS0_NLCA1_NLCB1_ONLL1_OPLV0_PK0_PAP0_PGR1_PLR1_RK0_SIA1_SS0_SU32_SUM3_SUS128_SCIUI1_SPO0_SRVW0_SSO0_SVW4_SNLL0_TT4_4_TLDS0_USFGROn1_VAW1_VSn1_VW1_WSGRA0_WSGRB0_WS32_WG16_16_1_WGM8 >> ${STATS_FILE}
    ${RUN_TOOL} ${RESNET_DIR}/Cijk_S.bin ${RESNET_PRECONDITION_DIR}/Cijk_S.json Cijk_S >> ${STATS_FILE}
    ${RUN_TOOL} ${RESNET_DIR}/elementwise.bin ${RESNET_PRECONDITION_DIR}/elementwise.json relu_generic >> ${STATS_FILE}
    ${RUN_TOOL} ${RESNET_DIR}/elementwise.bin ${RESNET_PRECONDITION_DIR}/elementwise.json addalpha_generic >> ${STATS_FILE}
    ${RUN_TOOL} ${RESNET_DIR}/elementwise.bin ${RESNET_PRECONDITION_DIR}/elementwise.json max_pool_forward_nchw >> ${STATS_FILE}
    ${RUN_TOOL} ${RESNET_DIR}/elementwise.bin ${RESNET_PRECONDITION_DIR}/elementwise.json avg_pool_forward_nchw >> ${STATS_FILE}
    ${RUN_TOOL} ${RESNET_DIR}/miopen_asm_conv.bin.modified ${RESNET_PRECONDITION_DIR}/miopen_asm_conv.json miopenSp3AsmConv_v21_1_3_gfx10_fp32_stride1 >> ${STATS_FILE}
    ${RUN_TOOL} ${RESNET_DIR}/miopen_batch_norm.bin ${RESNET_PRECONDITION_DIR}/miopen_batch_norm.json MIOpenBatchNormFwdInferSpatialEst >> ${STATS_FILE}
    ${RUN_TOOL} ${RESNET_DIR}/resnet_gen_kernels.bin ${RESNET_PRECONDITION_DIR}/resnet_gen_kernels.json transpose_NCHW2CNHW_V2_2D_WG >> ${STATS_FILE}
    ${RUN_TOOL} ${RESNET_DIR}/resnet_gen_kernels.bin ${RESNET_PRECONDITION_DIR}/resnet_gen_kernels.json transpose_CNHW2NCHW_V1_1D_WG_float4 >> ${STATS_FILE}
    ${RUN_TOOL} ${RESNET_DIR}/resnet_gen_kernels.bin ${RESNET_PRECONDITION_DIR}/resnet_gen_kernels.json transpose_CNHW2NCHW_V1_2D_WG_float4 >> ${STATS_FILE}
    ${RUN_TOOL} ${RESNET_DIR}/resnet_gen_kernels.bin ${RESNET_PRECONDITION_DIR}/resnet_gen_kernels.json transpose_CNHW2NCHW_V1_1D_WG_float >> ${STATS_FILE}
    ${RUN_TOOL} ${RESNET_DIR}/resnet_gen_kernels.bin ${RESNET_PRECONDITION_DIR}/resnet_gen_kernels.json Im2d2Col_wg1_x4_imb56_1449_stride1 >> ${STATS_FILE}
    ${RUN_TOOL} ${RESNET_DIR}/resnet_gen_kernels.bin ${RESNET_PRECONDITION_DIR}/resnet_gen_kernels.json Im2d2Col_wg1_x1_imb4_1105_stride1 >> ${STATS_FILE}
    ${RUN_TOOL} ${RESNET_DIR}/resnet_gen_kernels.bin ${RESNET_PRECONDITION_DIR}/resnet_gen_kernels.json Im2d2Col_wg1_x1_imb2_1105_stride1 >> ${STATS_FILE}
    ${RUN_TOOL} ${RESNET_DIR}/resnet_gen_kernels.bin ${RESNET_PRECONDITION_DIR}/resnet_gen_kernels.json Im2d2Col_wg1_x1_imb1_1105_stride1 >> ${STATS_FILE}
    ${RUN_TOOL} ${RESNET_DIR}/resnet_gen_kernels.bin ${RESNET_PRECONDITION_DIR}/resnet_gen_kernels.json Im2d2Col_wg4_x1_imb1_544_stride0 >> ${STATS_FILE}
    popd > /dev/null
}

build_validator
echo "Size, Validation-Time" > ${STATS_FILE}
run_accel
run_resnet

pushd ${RESULT_DIR} > /dev/null
gnuplot -c validation-time.gnuplot
popd > /dev/null
